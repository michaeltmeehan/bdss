<beast version='2.0'
    templateinfo='Minimal template to inject BirthDeathSuperSpreader as tree prior'
    namespace='beast.app.beauti
               :beast.base.core
               :beast.base.inference
               :beast.base.math.distributions
               :beast.base.evolution.tree
               :beast.base.evolution.likelihood
               :beast.base.evolution.alignment
               :beast.base.evolution.sitemodel
               :beast.base.evolution.substitutionmodel
               :beast.base.evolution.branchratemodel
               :bdss.evolution.speciation'>

<!-- Inject custom model as a tree prior -->
<mergewith point='treePriorTemplates'>
    <subtemplate id='BirthDeathSuperSpreaderModel'
                 class='bdss.evolution.speciation.BirthDeathSuperSpreader'
                 mainid='BirthDeathSuperSpreader.t:$(n)'
                 suppressInputs=''>
<![CDATA[
    <BirthDeathSuperSpreader spec='bdss.evolution.speciation.BirthDeathSuperSpreader'
                              id='BirthDeathSuperSpreader.t:$(n)'
                              tree='@Tree.t:$(n)'
                              stateNumber='2'>
        <tiptypes spec='beast.base.evolution.tree.TraitSet' traitname='type'>
            <taxa idref='TaxonSet.$(n)'/>
        </tiptypes>
        <relative_transmissibility spec='parameter.RealParameter' id='relTrans.t:$(n)' value='0.5'/>
        <total_r0 spec='parameter.RealParameter' id='totalR0.t:$(n)' value='1.5'/>
        <superspreader_fraction spec='parameter.RealParameter' id='ssFrac.t:$(n)' value='0.2'/>
    </BirthDeathSuperSpreader>
]]>


<!-- Connect tree prior to the prior distribution -->
    <connect srcID='BirthDeathSuperSpreader.t:$(n)'
             targetID='prior'
             inputName='distribution'
             if='inposterior(BirthDeathSuperSpreader.t:$(n)) and inlikelihood(Tree.t:$(n)) and Tree.t:$(n)/estimate=true'/>

	<connect srcID='BirthDeathSuperSpreader.t:$(n)' targetID='tracelog' inputName='log' if='inposterior(BirthDeathSuperSpreader.t:$(n))'/>

	<plate var='p' range='relative_transmissibility,total_r0,superspreader_fraction'>
		<connect srcID='$(p).t:$(n)' targetID='state' inputName='stateNode' if='BirthDeathSuperSpreader.t:$(n)/estimate=true and $(p).t:$(n)/estimate=true'/>
		<connect srcID='$(p).t:$(n)' targetID='tracelog' inputName='log' if='BirthDeathSuperSpreader.t:$(n)/estimate=true and $(p).t:$(n)/estimate=true'/>
	</plate>

	
    </subtemplate>
</mergewith>

</beast>
